<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Autenticação — Nova Vibe RP</title>
  <style>
    /* Seu CSS todo aqui — omitido para não poluir */
  </style>
</head>
<body>
  <!-- Sua estrutura HTML toda aqui — a mesma do seu arquivo -->

  <script>
    // Simulação de banco de dados local
    let users = JSON.parse(localStorage.getItem('users')) || [
      { id: 1, name: "João Silva", email: "joao@email.com", password: "123456" }
    ];
    let resetTokens = JSON.parse(localStorage.getItem('resetTokens')) || {};
    function saveUsers() { localStorage.setItem('users', JSON.stringify(users)); }
    function saveTokens() { localStorage.setItem('resetTokens', JSON.stringify(resetTokens)); }
    function saveLoggedUser(user) {
      const clientData = { id: user.id, nome: user.name, email: user.email, loginTime: new Date().toISOString() };
      localStorage.setItem('cliente', JSON.stringify(clientData));
    }

    const forms = {
      login: document.getElementById('login-form'),
      register: document.getElementById('register-form'),
      forgot: document.getElementById('forgot-form'),
      reset: document.getElementById('reset-form')
    };

    document.getElementById('show-register').onclick = e => { e.preventDefault(); showForm('register'); };
    document.getElementById('show-login').onclick = e => { e.preventDefault(); showForm('login'); };
    document.getElementById('show-forgot').onclick = e => { e.preventDefault(); showForm('forgot'); };
    document.getElementById('back-to-login').onclick = e => { e.preventDefault(); showForm('login'); };

    function showForm(formName) {
      Object.keys(forms).forEach(key => forms[key].classList.remove('active'));
      forms[formName].classList.add('active');
      clearAlerts();
    }

    function showAlert(formName, message, type = 'error') {
      const alertDiv = document.getElementById(`${formName}-alert`);
      alertDiv.innerHTML = `<div class="alert ${type}">${message}</div>`;
      setTimeout(() => { alertDiv.innerHTML = ''; }, 5000);
    }

    function clearAlerts() {
      ['login','register','forgot','reset'].forEach(f => {
        const el = document.getElementById(`${f}-alert`);
        if (el) el.innerHTML = '';
      });
    }

    document.getElementById('register-password').oninput = function() {
      const p = this.value;
      const fill = document.getElementById('strength-fill');
      const text = document.getElementById('strength-text');
      let strength = 0;
      if (p.length >= 8) strength++;
      if (/[a-z]/.test(p)) strength++;
      if (/[A-Z]/.test(p)) strength++;
      if (/[0-9]/.test(p)) strength++;
      if (/[^A-Za-z0-9]/.test(p)) strength++;
      const colors = ['#ef4444', '#f59e0b', '#eab308', '#22c55e', '#16a34a'];
      const labels = ['Muito fraca','Fraca','Média','Forte','Muito forte'];
      fill.style.width = `${(strength/5)*100}%`;
      fill.style.backgroundColor = colors[strength-1] || '#ef4444';
      text.textContent = labels[strength-1] || 'Muito fraca';
      text.style.color = colors[strength-1] || '#ef4444';
    }

    document.getElementById('register-form-element').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const confirm = document.getElementById('register-confirm').value;
      const btn = document.getElementById('register-btn');

      if (password !== confirm) return showAlert('register','As senhas não coincidem');
      if (password.length < 6) return showAlert('register','Senha mínima de 6 caracteres');

      btn.disabled = true;
      btn.innerHTML = '<span class="loading"></span> Criando conta...';

      fetch('https://czsnjdoxguldtznixcdj.supabase.co/functions/v1/cadastrar_usuario', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nome: name, email: email, senha: password })
      })
      .then(r => r.json())
      .then(data => {
        if (data.success) {
          showAlert('register','Conta criada com sucesso! Redirecionando...','success');
          setTimeout(() => window.location.href='loja.html', 2000);
        } else {
          showAlert('register', data.error || 'Erro ao cadastrar');
        }
      })
      .catch(err => {
        console.error(err);
        showAlert('register','Erro na conexão com o servidor');
      })
      .finally(() => {
        btn.disabled = false;
        btn.innerHTML = 'Criar conta';
      });
    });

    // Mantém os seus sistemas de login, reset de senha etc funcionando com localStorage como antes — não mexi neles
  </script>
</body>
</html>
