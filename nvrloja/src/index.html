<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nova Vibe Roleplay ‚Äî Loja Oficial</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background: #121216; color: #fff; font-family: 'Segoe UI', sans-serif; min-height: 100vh; }
    .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 20px 0; }
    header { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      background: #121216; 
      border-bottom: 1px solid #2f3a5a; 
      z-index: 1001; 
      padding: 10px 0; 
    }
    .header-content { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      width: 90%; 
      max-width: 1200px; 
      margin: 0 auto; 
    }
    
    .header-left h1 { 
      font-size: 1.8rem; 
      color: #fff; 
      margin: 0; 
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .header-left h1:hover {
      color: #2f3a5a;
    }
    .header-right { 
      display: flex; 
      align-items: center; 
      gap: 20px; 
    }
    .header-btn { 
      background: transparent; 
      border: 1px solid #2f3a5a; 
      color: #fff; 
      padding: 8px 12px; 
      border-radius: 6px; 
      cursor: pointer; 
      transition: all 0.3s ease; 
      font-size: 0.9rem; 
      display: flex; 
      align-items: center; 
      gap: 8px; 
      text-decoration: none; 
    }
    .header-btn:hover { 
      background: #2f3a5a; 
      transform: translateY(-1px); 
    }
    .header-btn.login { 
      background: #2f3a5a; 
    }
    .header-btn.login:hover { 
      background: #3f4b76; 
    }
    .header-btn.logout { 
      background: #e74c3c; 
      border-color: #e74c3c;
    }
    .header-btn.logout:hover { 
      background: #c0392b; 
      border-color: #c0392b;
    }
    .user-greeting {
      color: #fff;
      font-size: 0.9rem;
      opacity: 0.8;
      margin-right: 10px;
    }
    body { 
      padding-top: 65px; 
    }
    nav { margin: 20px 0; text-align: center; padding: 10px 0; border-bottom: 1px solid #2f3a5a; }
    nav a { color: #fff; text-decoration: none; padding: 10px 16px; margin: 0 6px; border-radius: 4px; transition: background 0.2s ease; cursor: pointer; }
    nav a:hover { background: #2f3a5a; }
    .intro { margin: 30px auto; text-align: center; font-size: 1rem; color: #ccc; line-height: 1.6; max-width: 750px; }
    .filter-buttons { text-align: center; margin: 30px 0 15px; }
    .filter-buttons button {
      background: transparent; border: 1.5px solid #2f3a5a; color: #fff; padding: 8px 18px;
      margin: 0 10px 10px 0; border-radius: 4px; font-weight: 600; cursor: pointer; transition: all 0.25s ease; font-size: 0.9rem;
    }
    .filter-buttons button:hover, .filter-buttons button.active { background: #2f3a5a; }
    .product-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
    .product-item { background: #1c1e28; border-radius: 8px; padding: 18px; display: flex; flex-direction: column; border: 1px solid transparent; transition: all 0.3s ease; }
    .product-item:hover { border-color: #2f3a5a; transform: translateY(-2px); }
    .product-item img { width: 100%; height: 160px; object-fit: cover; border-radius: 6px; margin-bottom: 14px; background: #2f3a5a; }
    .product-item h3 { margin-bottom: 10px; }
    .product-item p { flex-grow: 1; color: #ccc; margin-bottom: 12px; font-size: 0.9rem; }
    .product-item p strong { color: #fff; font-size: 1.05rem; }
    .product-item button {
      background: #2f3a5a; color: #fff; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: 600;
      transition: all 0.3s ease;
    }
    .product-item button:hover { background: #3f4b76; transform: translateY(-1px); }
    footer { margin-top: 50px; padding: 20px 0; text-align: center; border-top: 1px solid #2f3a5a; color: #bbb; font-size: 0.9rem; }
    
    /* Cart Overlay */
    #cart-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      display: none;
      backdrop-filter: blur(2px);
    }
    
    #cart {
      position: fixed; top: 0; right: -300px; width: 280px; height: 100%; background: #1c1e28;
      color: #fff; padding: 20px; box-shadow: -4px 0 12px rgba(0,0,0,0.4); transition: right 0.3s ease;
      overflow-y: auto; z-index: 1002; border-left: 1px solid #2f3a5a;
    }
    #cart.open { right: 0; }
    #cart h2 { font-size: 1.4rem; margin-bottom: 15px; }
    #cart-close { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }
    #cart ul { list-style: none; padding: 0; margin-bottom: 20px; }
    #cart ul li {
      margin-bottom: 10px; border-bottom: 1px solid #2f3a5a; padding-bottom: 8px; font-size: 0.9rem;
    }
    #cart ul li .item-info { margin-bottom: 5px; }
    #cart ul li .item-controls { display: flex; align-items: center; gap: 10px; }
    #cart ul li .item-controls button { 
      background: #2f3a5a; border: none; color: #fff; padding: 4px 8px; border-radius: 3px; cursor: pointer; font-size: 0.8rem;
    }
    #cart ul li .item-controls button:hover { background: #3f4b76; }
    #cart button { background: #3f4b76; border: none; color: #fff; padding: 10px; width: 100%; border-radius: 4px; cursor: pointer; font-weight: 600; margin-top: 10px; transition: all 0.3s ease; }
    #cart button:hover { background: #4f5d9e; transform: translateY(-1px); }
    
    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #e74c3c;
      color: #fff;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }
    
    .login-required {
      text-align: center;
      margin: 50px auto;
      max-width: 600px;
      padding: 40px;
      background: #1c1e28;
      border-radius: 8px;
      border: 1px solid #2f3a5a;
    }
    
    .login-required h2 {
      color: #fff;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .login-required p {
      color: #ccc;
      margin-bottom: 30px;
      line-height: 1.6;
    }
    
    .login-required .header-btn {
      display: inline-flex;
      background: #2f3a5a;
      padding: 12px 24px;
      font-size: 1rem;
    }
    
    @media (max-width: 768px) { 
      .product-list { grid-template-columns: repeat(2, 1fr); }
      #cart { width: 100%; right: -100%; }
      .header-right { gap: 10px; }
      .header-btn { padding: 6px 10px; font-size: 0.8rem; }
      .header-left h1 { font-size: 1.5rem; }
      .user-greeting { font-size: 0.8rem; }
    }
    @media (max-width: 500px) { 
      .product-list { grid-template-columns: 1fr; }
      .header-content { width: 95%; }
      .header-right { gap: 8px; }
      .header-btn { padding: 5px 8px; font-size: 0.75rem; }
      .header-left h1 { font-size: 1.3rem; }
      .user-greeting { font-size: 0.7rem; }
    }
  </style>
</head>
<body>

<header>
  <div class="header-content">
    <div class="header-left">
      <h1 onclick="scrollToTop()">Nova Vibe Roleplay</h1>
    </div>
    <div class="header-right" id="header-right">
      <!-- Conte√∫do ser√° inserido pelo JavaScript -->
    </div>
  </div>
</header>

<nav style="display: none;">
  <a href="#" onclick="scrollToTop()">In√≠cio</a>
</nav>

<div id="login-required" class="login-required" style="display: none;">
  <h2>üîê Acesso Restrito</h2>
  <p>Voc√™ precisa estar logado para acessar nossa loja oficial. Fa√ßa login ou crie uma conta gratuita para come√ßar suas compras!</p>
  <a href="https://novaviberoleplay.netlify.app/login.html" class="header-btn login">
    üë§ Fazer Login
  </a>
</div>

<div id="loja-content" style="display: none;">
  <div class="filter-buttons">
    <button data-filter="all" class="active" onclick="filterProducts('all')">Todos</button>
    <button data-filter="casas" onclick="filterProducts('casas')">Casas</button>
    <button data-filter="veiculos" onclick="filterProducts('veiculos')">Ve√≠culos</button>
    <button data-filter="extras" onclick="filterProducts('extras')">Extras</button>
  </div>

  <main class="container">
    <section class="product-list">
      <div class="product-item" data-category="casas">
        <img src="https://five-rp.de/wp-content/uploads/2024/07/chrome_nQisegy55l-1024x573.jpg.webp" alt="Mans√£o Vista Mar" />
        <h3>Mans√£o Vista Mar</h3>
        <p>Luxo √† beira-mar com garagem p/ 5 carros.</p>
        <p><strong>R$ 1.200,00</strong></p>
        <button onclick="addToCart('Mans√£o Vista Mar', 1200)">Adicionar ao Carrinho</button>
      </div>

      <div class="product-item" data-category="veiculos">
        <img src="https://img.gta5-mods.com/q95/images/lamborghini-urus-2018-add-on/2b9a2a-PGTA51544780450.jpg" alt="Lamborghini Urus" />
        <h3>Lamborghini Urus</h3>
        <p>V12 Biturbo, o mais veloz da cidade.</p>
        <p><strong>R$ 850,00</strong></p>
        <button onclick="addToCart('Lamborghini Urus', 850)">Adicionar ao Carrinho</button>
      </div>

      <div class="product-item" data-category="extras">
        <img src="https://storage.hydrus.gg/production/packages/mwUds4zV929tBziSfiAs5gG64TqNnwOlcjCXZsKIqVPsixKUiR1DXeGtOUjmGPfq.png" alt="VIP Gold" />
        <h3>VIP Ouro (30d)</h3>
        <p>Acesso VIP com benef√≠cios exclusivos.</p>
        <p><strong>R$ 299,00</strong></p>
        <button onclick="addToCart('VIP Ouro (30d)', 299)">Adicionar ao Carrinho</button>
      </div>

      <div class="product-item" data-category="casas">
        <img src="https://img.gta5-mods.com/q95/images/single-player-mode-custom-apartment-menyoo-mapeditor-adco1234/6f0395-9e73e5-46f5ac-GTA5%202016-05-02%2012-17-12-54_%E5%89%AF%E6%9C%AC.png" alt="Apartamento Moderno" />
        <h3>Apartamento Moderno</h3>
        <p>Localiza√ß√£o central com vista panor√¢mica.</p>
        <p><strong>R$ 180,00</strong></p>
        <button onclick="addToCart('Apartamento Moderno', 180)">Adicionar ao Carrinho</button>
      </div>

      <div class="product-item" data-category="veiculos">
        <img src="https://img.gta5-mods.com/q95/images/2020-yamaha-yzf-r1-r1m/b82192-a.jpg" alt="Moto Esportiva" />
        <h3>Moto Esportiva R1</h3>
        <p>Velocidade e agilidade nas ruas.</p>
        <p><strong>R$ 85,00</strong></p>
        <button onclick="addToCart('Moto Esportiva R1', 85)">Adicionar ao Carrinho</button>
      </div>

      <div class="product-item" data-category="extras">
        <img src="https://storage.hydrus.gg/production/packages/yKxKYS3wtu4Xz1Y6N2ui9TM0oTUpYOKTrLx7bTSqW8BREpXUWLp5wojEkwMRBkgc.png" alt="VIP Premium" />
        <h3>VIP Permanente</h3>
        <p>M√°ximo de privil√©gios no servidor.</p>
        <p><strong>R$ 1.390,00</strong></p>
        <button onclick="addToCart('VIP Permanente', 1390)">Adicionar ao Carrinho</button>
      </div>
    </section>
  </main>
</div>

<footer>
  <div class="container">&copy; 2025 Nova Vibe RP ‚Äî Todos os direitos reservados.</div>
</footer>

<!-- Cart Overlay -->
<div id="cart-overlay" onclick="closeCart()"></div>

<div id="cart">
  <h2>Carrinho</h2>
  <ul id="cart-items"></ul>
  <div id="cart-total" style="margin-top: 15px; font-weight: bold; font-size: 1rem; border-top: 1px solid #2f3a5a; padding-top: 15px;">
    Total: R$ 0,00
  </div>
  <button id="finalizar-btn" style="display:none;" onclick="finalizarCompra()">Finalizar Compra</button>
  <button id="limpar-btn" style="display:none;" onclick="limparCarrinho()">Limpar Carrinho</button>
</div>

<script>
  // Configura√ß√£o do Supabase (mesmo da p√°gina de login)
  const supabaseUrl = 'https://czsnjdoxguldtznixcdj.supabase.co';
  const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN6c25qZG94Z3VsZHR6bml4Y2RqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIwMzI0NTAsImV4cCI6MjA2NzYwODQ1MH0.PCTVMRqrDD-5jsTXwQOHZP-uuNBwjbcjlfOZBidRcaU';

  // Vari√°veis globais
  let usuarioLogado = null;
  let carrinho = [];

  // Elementos do DOM
  const cartItems = document.getElementById('cart-items');
  const cart = document.getElementById('cart');
  const cartOverlay = document.getElementById('cart-overlay');
  const cartTotal = document.getElementById('cart-total');
  const headerRight = document.getElementById('header-right');
  const loginRequired = document.getElementById('login-required');
  const lojaContent = document.getElementById('loja-content');

  // Fun√ß√£o para verificar se o usu√°rio est√° logado
  function verificarLogin() {
    try {
      const userData = localStorage.getItem('nova_vibe_user');
      
      if (!userData) {
        mostrarTelaLogin();
        return false;
      }

      const user = JSON.parse(userData);
      
      // Verificar se o token ainda √© v√°lido
      if (user.expires_at && new Date(user.expires_at * 1000) <= new Date()) {
        // Token expirado
        localStorage.removeItem('nova_vibe_user');
        mostrarTelaLogin();
        return false;
      }

      // Verificar se tem as informa√ß√µes necess√°rias
      if (!user.email || !user.logged_in) {
        mostrarTelaLogin();
        return false;
      }

      usuarioLogado = user;
      mostrarLoja();
      return true;
    } catch (error) {
      console.error('Erro ao verificar login:', error);
      mostrarTelaLogin();
      return false;
    }
  }

  // Fun√ß√£o para mostrar tela de login
  function mostrarTelaLogin() {
    loginRequired.style.display = 'block';
    lojaContent.style.display = 'none';
    
    // Cabe√ßalho para usu√°rio n√£o logado
    headerRight.innerHTML = `
      <a href="https://novaviberoleplay.netlify.app/login.html" class="header-btn login">
        üë§ Fazer Login
      </a>
    `;
  }

  // Fun√ß√£o para mostrar a loja
  function mostrarLoja() {
    loginRequired.style.display = 'none';
    lojaContent.style.display = 'block';
    
    // Mostrar informa√ß√µes do usu√°rio no cabe√ßalho
    const primeiroNome = usuarioLogado.name ? usuarioLogado.name.split(' ')[0] : usuarioLogado.email.split('@')[0];
    
    headerRight.innerHTML = `
      <span class="user-greeting">Ol√°, ${primeiroNome}</span>
      <button class="header-btn" onclick="openCart()" style="position: relative;">
        üõí Carrinho
        <span id="cart-badge-header" class="cart-badge" style="display: none;">0</span>
      </button>
      <button class="header-btn logout" onclick="fazerLogout()">Sair</button>
    `;
    
    // Carregar carrinho salvo
    carregarCarrinho();
  }

  // Fun√ß√£o para adicionar ao carrinho
  function addToCart(produto, preco) {
    const itemExistente = carrinho.find(item => item.produto === produto);
    if (itemExistente) {
      itemExistente.quantidade++;
    } else {
      carrinho.push({ produto, preco: parseFloat(preco), quantidade: 1 });
    }
    atualizarCarrinho();
    salvarCarrinho();
    
    // Feedback visual
    const button = event.target;
    const originalText = button.textContent;
    button.textContent = 'Adicionado!';
    button.style.background = '#27ae60';
    
    setTimeout(() => {
      button.textContent = originalText;
      button.style.background = '#2f3a5a';
    }, 1000);
  }

  // Fun√ß√µes de manipula√ß√£o de quantidade
  function aumentarQuantidade(produto) {
    const item = carrinho.find(item => item.produto === produto);
    if (item) {
      item.quantidade++;
      atualizarCarrinho();
      salvarCarrinho();
    }
  }

  function diminuirQuantidade(produto) {
    const item = carrinho.find(item => item.produto === produto);
    if (item) {
      item.quantidade--;
      if (item.quantidade <= 0) {
        carrinho = carrinho.filter(i => i.produto !== produto);
      }
      atualizarCarrinho();
      salvarCarrinho();
    }
  }

  function removerItem(produto) {
    carrinho = carrinho.filter(i => i.produto !== produto);
    atualizarCarrinho();
    salvarCarrinho();
  }

  function limparCarrinho() {
    if (confirm('Tem certeza que deseja limpar o carrinho?')) {
      carrinho = [];
      atualizarCarrinho();
      salvarCarrinho();
    }
  }

  // Fun√ß√£o para salvar carrinho no localStorage
  function salvarCarrinho() {
    if (usuarioLogado) {
      const carrinhoKey = `carrinho_${usuarioLogado.id}`;
      const carrinhoData = carrinho.map(item => ({
        produto: item.produto,
        preco: item.preco,
        quantidade: item.quantidade
      }));
      localStorage.setItem(carrinhoKey, JSON.stringify(carrinhoData));
    }
  }

  // Fun√ß√£o para carregar carrinho do localStorage
  function carregarCarrinho() {
    if (usuarioLogado) {
      const carrinhoKey = `carrinho_${usuarioLogado.id}`;
      const carrinhoSalvo = localStorage.getItem(carrinhoKey);
      if (carrinhoSalvo) {
        carrinho = JSON.parse(carrinhoSalvo);
        atualizarCarrinho();
      }
    }
  }

  // Fun√ß√£o para atualizar o carrinho
  function atualizarCarrinho() {
    if (!cartItems) return;
    
    cartItems.innerHTML = '';
    let total = 0;
    let totalItens = 0;
    
    carrinho.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `
        <div class="item-info">
          <strong>${item.produto}</strong><br>
          R$ ${item.preco.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
        </div>
        <div class="item-controls">
          <button onclick="diminuirQuantidade('${item.produto}')">-</button>
          <span>${item.quantidade}</span>
          <button onclick="aumentarQuantidade('${item.produto}')">+</button>
          <button onclick="removerItem('${item.produto}')" style="background: #e74c3c; margin-left: auto;">‚úï</button>
        </div>
      `;
      cartItems.appendChild(li);
      total += item.preco * item.quantidade;
      totalItens += item.quantidade;
    });
    
    cartTotal.textContent = `Total: R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
    
    // Atualizar badge do carrinho
    const cartBadge = document.getElementById('cart-badge-header');
    if (cartBadge) {
      if (totalItens > 0) {
        cartBadge.textContent = totalItens;
        cartBadge.style.display = 'flex';
      } else {
        cartBadge.style.display = 'none';
      }
    }
    
    // Mostrar/esconder bot√µes
    const finalizarBtn = document.getElementById('finalizar-btn');
    const limparBtn = document.getElementById('limpar-btn');
    
    if (finalizarBtn) finalizarBtn.style.display = carrinho.length ? 'block' : 'none';
    if (limparBtn) limparBtn.style.display = carrinho.length ? 'block' : 'none';
  }

  // Fun√ß√µes do carrinho
  function openCart() {
    if (!usuarioLogado) {
      alert('Fa√ßa login para acessar o carrinho!');
      return;
    }
    
    cart.classList.add('open');
    cartOverlay.style.display = 'block';
    document.body.style.overflow = 'hidden';
  }

  function closeCart() {
    cart.classList.remove('open');
    cartOverlay.style.display = 'none';
    document.body.style.overflow = 'auto';
  }

  function finalizarCompra() {
    if (carrinho.length === 0) {
      alert('Carrinho vazio!');
      return;
    }
    
    if (!usuarioLogado) {
      alert('Fa√ßa login para finalizar a compra!');
      return;
    }
    
    // Preparar dados para checkout
    const checkoutData = {
      usuario: usuarioLogado,
      carrinho: carrinho,
      total: carrinho.reduce((sum, item) => sum + (item.preco * item.quantidade), 0)
    };
    
    // Salvar dados do checkout
    localStorage.setItem('checkout_data', JSON.stringify(checkoutData));
    
    // Redirecionar para checkout
    window.location.href = 'checkout.html';
  }

  // Fun√ß√£o para filtrar produtos
  function filterProducts(category) {
    const products = document.querySelectorAll('.product-item');
    const buttons = document.querySelectorAll('.filter-buttons button');
    
    // Atualizar bot√µes ativos
    buttons.forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-filter="${category}"]`).classList.add('active');
    
    // Filtrar produtos
    products.forEach(product => {
      if (category === 'all' || product.dataset.category === category) {
        product.style.display = 'flex';
      } else {
        product.style.display = 'none';
      }
    });
  }

  // Fun√ß√£o para scroll ao topo
  function scrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }

  // Fun√ß√£o para fazer logout
  function fazerLogout() {
    if (confirm('Tem certeza que deseja fazer logout?')) {
      // Limpar dados do usu√°rio
      localStorage.removeItem('nova_vibe_user');
      
      // Limpar carrinho do usu√°rio
      if (usuarioLogado) {
        const carrinhoKey = `carrinho_${usuarioLogado.id}`;
        localStorage.removeItem(carrinhoKey);
      }
      
      // Limpar dados de checkout
      localStorage.removeItem('checkout_data');
      
      alert('Logout realizado com sucesso!');
      window.location.href = 'https://novaviberoleplay.netlify.app/login.html';
    }
  }

  // Event listeners
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && cart.classList.contains('open')) {
      closeCart();
    }
  });

  // Inicializar a aplica√ß√£o
  document.addEventListener('DOMContentLoaded', function() {
    verificarLogin();
  });

  // Verificar login ao carregar a p√°gina
  window.addEventListener('load', function() {
    verificarLogin();
  });
</script>

</body>
</html>
